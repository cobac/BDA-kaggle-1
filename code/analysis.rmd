---
title: First Kaggle competition, first submission - Group 3
author: 
 - David Coba
 - Sophie Elting
 - Enrico Erler
output: html_document
---

# Setup environment 

```{r}

library(tidyverse) # metapackage with lots of helpful functions
library(tidytext)

list.files(path = "../input/")
```

```{r}
directory_content = list.files("../input/bda2021big5/youtube-personality", full.names = TRUE)
print(directory_content)
```

```{r}
# Path to the transcripts directory with transcript .txt files
path_to_transcripts <- directory_content[2] 

# .csv filenames (see output above)
AudioVisual_file <- directory_content[3]
Gender_file      <- directory_content[4]
Personality_file <- directory_content[5]
```

# 1. Import the data

## 1.1 Importing transcripts


```{r}
transcript_files <- list.files(path_to_transcripts, full.names = TRUE) 

print(head(transcript_files))
```

```{r}
vlogId <- basename(transcript_files)
vlogId <- str_replace(vlogId, pattern = ".txt$", replacement = "")
head(vlogId)
```

```{r}
transcripts_df <- tibble(
    
  # vlogId connects each transcripts to a vlogger
  vlogId=vlogId,
  
  # Read the transcript text from all file and store as a string
  Text = map_chr(transcript_files, ~ paste(readLines(.x), collapse = "\\n")), 
  
  # `filename` keeps track of the specific video transcript
  filename = transcript_files
)
```

```{r}
transcripts_df %>% 
  head(2)
```

## Import personality scores


```{r}
# Import the Personality scores
pers_df <- read_delim(Personality_file, delim=" ")
head(pers_df)
```

## Import gender

```{r}
gender_df <- read.delim(Gender_file, head=FALSE, sep=" ", skip = 1)
# Add column names
names(gender_df) = c('vlogId', 'gender')
head(gender_df)
```

## Import audiovisual data
```{r}
audiovisual_df <- read.delim(AudioVisual_file, head = TRUE, sep = " ")
```


## Merging the `gender` and `pers` dataframes

- Initializing the main data frame with all the predictors that are going to be used in the analysis

```{r}
vlogger_df <- left_join(gender_df, pers_df)
head(vlogger_df) # VLOG8 has missing personality scores: those should be predicted
```

# 2. Feature extraction from transcript texts

```{r}
# Here goes YOUR CODE to compute the dataframe `transcript_features_df`




#
```


```{r}
# YOUR CODE to merge `vlogger_df` with `transcript_features_df`



#
```

# 3. Predictive model

Next you fit your predictive model(s). For instance, a linear regression model that only uses `gender` a feature might be:

```{r}
# Only for demonstration purposes:
fit_mlm <- lm(cbind(Extr, Agr, Cons, Emot, Open) ~ gender, data = vlogger_df)
fit_mlm
```

```{r}



```

# 4. Generating predictions

## 4.1 The test set


```{r}
testset_vloggers <- vlogger_df %>% 
  filter(is.na(Extr))

head(testset_vloggers)
```

## 4.2 Predictions

```{r}
pred_mlm <- predict(fit_mlm, newdata = testset_vloggers)

# Always check the output
head(pred_mlm)
```

```{r}
# compute output data frame
testset_pred <- testset_vloggers %>% 
  mutate(
    Extr = pred_mlm[,'Extr'], 
    Agr  = pred_mlm[,'Agr' ],
    Cons = pred_mlm[,'Cons'],
    Emot = pred_mlm[,'Emot'],
    Open = pred_mlm[,'Open']
  ) %>%
  select(vlogId, Extr:Open)

head(testset_pred)
```

## 4.3 Writing predictions to file

```{r}
final_predictions <- 
  testset_pred %>% 
  gather(pers_axis, value, -vlogId) %>%
  arrange(vlogId, pers_axis) %>% 
  unite(Id, vlogId, pers_axis) %>%
  write_csv(path = "predictions.csv") 
head(final_predictions)
```
